<%- include('navigation') %>

<div class="main-with-sidebar">
  <div class="container">
    <h1>Edit User</h1>
    <p style="color:var(--muted);margin-top:6px">Update user information</p>

    <div class="card" style="max-width:500px;margin-top:24px">
      <% if (typeof error !== 'undefined' && error) { %>
        <div style="color:#ff6b6b;background:rgba(255,107,107,0.1);padding:12px;border-radius:6px;margin-bottom:16px;font-size:13px">
          <%= error %>
        </div>
      <% } %>

      <form action="/admin/users/edit/<%= user._id %>" method="POST">
        <input type="hidden" name="role" value="<%= user.role %>" />
        
        <div class="form-row">
          <label>Name</label>
          <input type="text" name="name" value="<%= user.name %>" required />
        </div>

        <div class="form-row">
          <label>Email</label>
          <input type="email" name="email" value="<%= user.email %>" required />
        </div>

        <div class="form-row">
          <label>Phone</label>
          <input type="text" name="phone" value="<%= user.phone %>" required />
        </div>

        <div class="form-row">
          <label>Role</label>
          <input type="text" value="<%= user.role %>" disabled style="background:rgba(255,255,255,0.02);opacity:0.6;cursor:not-allowed" />
          <p style="font-size:12px;color:var(--muted);margin:8px 0 0">Role cannot be changed</p>
        </div>

        <% if (user.role !== 'Admin' && departments) { %>
          <div class="form-row">
            <label>Department</label>
            <select name="departmentId" required>
              <% departments.forEach(dept => { %>
                <option value="<%= dept._id %>" <%= (user.departmentId && (user.departmentId._id === dept._id || user.departmentId === dept._id)) ? 'selected' : '' %>>
                  <%= dept.name %>
                </option>
              <% }) %>
            </select>
          </div>
        <% } %>

        <div style="display:flex;gap:12px;margin-top:24px">
          <button type="submit" class="btn primary">Save Changes</button>
          <a href="/admin/users/list" class="btn secondary" style="text-align:center;flex:1">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>